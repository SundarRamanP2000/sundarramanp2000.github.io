<!meta charset="UTF-8" name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<canvas id="drawContainer" width="500" height="500" style="border: 1px solid #333"></canvas>
<script>
const canvas = document.getElementById('drawContainer');
const ctx = canvas.getContext('2d');
//let startPosition = {x: 0, y: 0};
//let lineCoordinates = {x: 0, y: 0};
//let isDrawStart = false;

var r=7;
var touchesInAction = {};
var isDrawStart, startPosition, lineCoordinates;

function arrow(ctx,p1,p2,size){
      ctx.fillStyle = ctx.strokeStyle = '#099';
     ctx.save();
      var dx = p2.x-p1.x, dy=p2.y-p1.y, len=Math.sqrt(dx*dx+dy*dy);
      ctx.translate(p2.x,p2.y);
      ctx.rotate(Math.atan2(dy,dx));
      ctx.lineCap = 'round';
      ctx.beginPath();
      ctx.moveTo(0,0);
      ctx.lineTo(-len,0);
      ctx.closePath();
      ctx.stroke();
      ctx.beginPath();
      ctx.moveTo(0,0);
      ctx.lineTo(-size,-size);
      ctx.lineTo(-size, size);
      ctx.closePath();
      ctx.fill();
    ctx.restore();
}


const getClientOffset = (event) => {
    const {pageX, pageY} = event.touches ? event.touches[0] : event;
    const x = pageX - canvas.offsetLeft;
    const y = pageY - canvas.offsetTop;

    return {
       x,
       y
    } 
}

const mouseDownListener = (event) => {
   startPosition = getClientOffset(event);
   isDrawStart = true;
}

const mouseMoveListener = (event) => {
  if(!isDrawStart) return;
  
  lineCoordinates = getClientOffset(event);
  clearCanvas();
  arrow(context,{x: startPosition.x, y: startPosition.y},{x: lineCoordinates.x,y: lineCoordinates.y},10);
}

const mouseupListener = (event) => {
  isDrawStart = false;
	
}

const clearCanvas = () => {
   ctx.clearRect(0, 0, canvas.width, canvas.height);
}

function process_touchstart(event)
{
event.preventDefault();
var touches = getClientOffset(event);  //event.touches;changedTouches;
if(touches!=undefined)
{
startPosition=touches;
console.log('sg',startPosition.x,startPosition.y);
ctx.fillStyle = ctx.strokeStyle = '#099';

ctx.beginPath();
    
ctx.arc(startPosition.x,startPosition.y, r, 0, 2 * Math.PI);
ctx.fill();
isDrawStart=true;
}
}

function process_touchmove(event){
event.preventDefault();
var touches = event.changedTouches;

if(touches!=undefined)
{
console.log('nopeee');
  if(!isDrawStart) return;
  lineCoordinates=touches;
  clearCanvas();

  arrow(ctx,startPosition,lineCoordinates,10);
}
}

function process_touchend(event) {

event.preventDefault();
var touches = event.changedTouches;
if(touches!=undefined)
{console.log('jb');
  isDrawStart=false;
}
}
//canvas.addEventListener('mousedown', mouseDownListener);
//canvas.addEventListener('mousemove', mouseMoveListener);
//canvas.addEventListener('mouseup', mouseupListener);
canvas.addEventListener('mousedown', process_touchstart,false);
canvas.addEventListener('mousemove', process_touchmove,false);
//canvas.addEventListener('touchcancel', process_touchcancel, false);
canvas.addEventListener('mouseup', process_touchend,false);

canvas.addEventListener('touchstart', process_touchstart,false);
canvas.addEventListener('touchmove', process_touchmove,false);
//canvas.addEventListener('touchcancel', process_touchcancel, false);
canvas.addEventListener('touchend', process_touchend,false);
/*
someElement.addEventListener('touchstart', process_touchstart, false);
someElement.addEventListener('touchmove', process_touchmove, false);
someElement.addEventListener('touchend', process_touchend, false);*/
//3
</script>

